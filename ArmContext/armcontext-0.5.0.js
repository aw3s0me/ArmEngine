(function(b){b.ArmContext={_lastUnicalNumber:0,GetNewUnicalNumber:function(){return this._lastUnicalNumber+=1}}})(window);(function(){ArmContext.InternalRepresentation=function(){var b={};b._points=new $M([[0,0,1]]);b.GetPoints=function(){return this._points.elements};b.ShowPoints=function(a){var c=this.GetPoints();a.save();a.beginPath();for(var d in c)a.moveTo(c[d][0],c[d][1]),a.arc(c[d][0],c[d][1],3,0,2*Math.PI,!1);a.closePath();CTX.fillStyle="#ff0000";a.stroke();a.fill();a.restore();return this};b.ShowDebugInfo=function(){var a=this.GetPoints();console.log("Points of internal representation");for(var c in a)console.log(a[c])};
return b}})();(function(){ArmContext.GlobalRepresentation=function(){var b={};b._points=new $M([[0,0,1]]);b._polygone=new gizmo.Math.Polygone(b._points.elements);b.GetPoints=function(){return this._points.elements};b.SetPoints=function(a){gizmo.Filter(a,"Array");this._points.elements=a};b.GetMatrixOfPoints=function(){return this._points};b.SetMatrixOfPoints=function(a){gizmo.Filter(a,"Object");return this._points=a};b.Update=function(a,c,d){gizmo.Filter(a,"Object");gizmo.Filter(c,"Object");gizmo.Filter(d,"Object");
this.SetPoints(a.GetPoints());this.SetMatrixOfPoints(this.GetMatrixOfPoints().x(d.GetMatrix()));this.UpdatePolygone();return this};b.UpdatePolygone=function(){arrVectors=[];var a=this.GetPoints(),c;for(c in a)arrVectors.push(new gizmo.Math.Vector2D(a[c][0],a[c][1]));this._polygone=new gizmo.Math.Polygone(arrVectors);return this};b.HasPoint=function(a,c){gizmo.Filter(a,"Number");gizmo.Filter(c,"Number");return this._polygone.HasPoint({x:a,y:c})};b.ShowDebugInfo=function(){var a=this.GetPoints();console.log("Points of global representation");
for(var c in a)console.log(a[c])};b.ShowPoints=function(){var a=this.GetPoints(),c;for(c in a)CTX.save(),CTX.beginPath(),CTX.fillStyle="#00ff00",CTX.rect(a[c][0]-2,a[c][1]-2,4,4),CTX.stroke(),CTX.fill(),CTX.closePath(),CTX.restore()};return b}})();(function(){ArmContext.C2dContextRepresentation=function(){return{_primitive:null,_ctx:null,_layer:null,_globalAlpha:"default",_shadowColor:"default",_shadowBlur:"default",_shadowOffsetX:"default",_shadowOffsetY:"default",_zindex:0,_boundingBox:{},_pictureUnderPrimitive:{},Update:function(b){for(var a in b)switch(a){case "ctx":this.SetCtx(b[a]);break;case "layer":this.SetLayer(b[a]);this.SetCtx(this.GetLayer().GetCtx());break;case "globalAlpha":this.SetGlobalAlpha(b[a]);break;case "shadowColor":this.SetShadowColor(b[a]);
break;case "shadowBlur":this.SetBlur(b[a]);break;case "shadowOffsetX":this.SetShadowOffsetX(b[a]);break;case "shadowOffsetY":this.SetShadowOffsetY(b[a]);break;case "zindex":this.SetZindex(b[a])}},SetCtx:function(b){gizmo.Filter(b,"CanvasRenderingContext2D");this._ctx=b},SetLayer:function(b){gizmo.Filter(b,"Object");this._layer=b;this._layer.AddPrimitive(this._primitive)},SetGlobalAlpha:function(b){gizmo.Filter(b,"Number");this._globalAlpha=b},SetShadowColor:function(b){gizmo.Filter(b,"String");this._shadowColor=
b},SetShadowBlur:function(b){gizmo.Filter(b,"Number");this._shadowBlur=b},SetShadowOffsetX:function(b){gizmo.Filter(b,"Number");this._shadowOffsetX=b},SetShadowOffsetY:function(b){gizmo.Filter(b,"Number");this._shadowOffsetY=b},SetZindex:function(b){gizmo.Filter(b,"Number");this._zindex=b;this.GetLayer().SortByZindex()},GetCtx:function(){return this._ctx},GetLayer:function(){return this._layer},GetGlobalAlpha:function(){return this._globalAlpha},GetShadowColor:function(){return this._shadowColor},
GetShadowBlur:function(){return this._shadowBlur},GetShadowOffsetX:function(){return this._shadowOffsetX},GetShadowOffsetY:function(){return this._shadowOffsetY},GetZindex:function(){return this._zindex},ShowDebugInfo:function(){console.log("VisualProperties:");console.log("Method have not realisation")}}}})();(function(){ArmContext.MvMatrix=function(){var b={};b._matrix=new $M([[1,0,0],[0,1,0],[0,0,1]]);b.Rotate=function(a){var c=Math.cos(a),a=Math.sin(a),c=new $M([[c,a,0],[-a,c,0],[0,0,1]]);this._matrix=this._matrix.x(c);return this};b.Scale=function(a,c){gizmo.Filter(a,"Number");gizmo.Filter(c,"Number");var d=new $M([[a,0,0],[0,c,0],[0,0,1]]);this._matrix=this._matrix.x(d);return this};b.Translate=function(a,c){gizmo.Filter(a,"Number");gizmo.Filter(c,"Number");var d=new $M([[1,0,0],[0,1,0],[a,c,1]]);
this._matrix=this._matrix.x(d);return this};b.Scos=function(a,c){gizmo.Filter(a,"Number");gizmo.Filter(c,"Number");var d=new $M([[1,c,0],[a,1,0],[0,0,1]]);this._matrix=this._matrix.x(d);return this};b.GetMatrix=function(){return this._matrix};b.GetTransformParams=function(){var a=this.GetMatrix();return{a:a.elements[0][0],b:a.elements[0][1],c:a.elements[1][0],d:a.elements[1][1],e:a.elements[2][0],f:a.elements[2][1]}};b.ShowDebugInfo=function(){var a=this.GetMatrix();console.log("mvMatrix:");console.log(a.elements[0]);
console.log(a.elements[1]);console.log(a.elements[2])};return b}})();(function(){ArmContext.Debug=function(b){gizmo.Filter(b,"Object");var a={};a.object=b;a.ShowDebugInfo=function(){console.log("<<Primitive>> DebugInfo");this.object._2dContextRepresentation.ShowDebugInfo();this.object._interalRepresentation.ShowDebugInfo();this.object._globalRepresentation.ShowDebugInfo();this.object._mvMatrix.ShowDebugInfo()};return a}})();(function(b){b.ArmContext.Primitive=function(){var a={_internalRepresentation:null,_2dContextRepresentation:null,_globalRepresentation:null};a._mvMatrix=ArmContext.MvMatrix();a._debug=ArmContext.Debug(a);a._isLisened=!0;a.TranslateTo=function(a){gizmo.Filter(a,"Object");gizmo.Filter(a.x,"Number");gizmo.Filter(a.y,"Number");var d=this._globalRepresentation.GetX(),b=this._globalRepresentation.GetY();this._mvMatrix.Translate(a.x-d,a.y-b);this._globalRepresentation.Update(this._internalRepresentation,
this._2dContextRepresentation,this._mvMatrix);return this};a.Translate=function(a){gizmo.Filter(a,"Object");gizmo.Filter(a.x,"Number");gizmo.Filter(a.y,"Number");this._mvMatrix.Translate(a.x,a.y);this._globalRepresentation.Update(this._internalRepresentation,this._2dContextRepresentation,this._mvMatrix);return this};a.Rotate=function(a){gizmo.Filter(a.gradAngle||a.radAngle,"Number");gizmo.Filter(a.x,"Number");gizmo.Filter(a.y,"Number");var b=a.radAngle||(360<a.gradAngle?a.gradAngle%360:a.gradAngle)/
180*Math.PI;this._mvMatrix.Translate(-a.x,-a.y);this._mvMatrix.Rotate(b);this._mvMatrix.Translate(a.x,a.y);this._globalRepresentation.Update(this._internalRepresentation,this._2dContextRepresentation,this._mvMatrix);return this};a.Scale=function(a){gizmo.Filter(a,"Object");gizmo.Filter(a.x,"Number");gizmo.Filter(a.y,"Number");var b=this._globalRepresentation.GetX(),e=this._globalRepresentation.GetY(),b=b-b*a.x,e=e-e*a.y;this._mvMatrix.Scale(a.x,a.y);this._mvMatrix.Translate(b,e);this._globalRepresentation.Update(this._internalRepresentation,
this._2dContextRepresentation,this._mvMatrix);return this};a.Scos=function(a){gizmo.Filter(a,"Object");gizmo.Filter(a.x,"Number");gizmo.Filter(a.y,"Number");this._mvMatrix.Scos(a.x,a.y);this._globalRepresentation.Update(this._internalRepresentation,this._2dContextRepresentation,this._mvMatrix);return this};a.Draw=function(){console.log("Virtual method Draw");return this};a.Clear=function(){console.log("Virtual method Clear");return this};a.HasPoint=function(a){gizmo.Filter(a,"Object");gizmo.Filter(a.x,
"Number");gizmo.Filter(a.y,"Number");return this._globalRepresentation.HasPoint(a.x,a.y)};a.Update=function(a){this._internalRepresentation.Update(a);this._2dContextRepresentation.Update(a);this._globalRepresentation.Update(this._internalRepresentation,this._2dContextRepresentation,this._mvMatrix)};a.SetLisened=function(a){gizmo.Filter(a,"Boolean");this._isLisened=a};a.IsLisened=function(){return this._isLisened};return a}})(window);(function(){ArmContext.Image2dContextRepresentation=function(b){var a=ArmContext.C2dContextRepresentation();a._primitive=b;a.parentUpdate=a.Update?a.Update:null;a._image=null;a.GetImage=function(){return this._image};a.Update=function(a){this.parentUpdate&&this.parentUpdate(a);this._image=a.image||this._image};return a}})();(function(){ArmContext.ImageGlobalRepresentation=function(){var b=ArmContext.GlobalRepresentation();b.GetX=function(){return this.GetPoints()[0][0]};b.GetY=function(){return this.GetPoints()[0][1]};b.GetWidth=function(){this.GetPoints();return points[2][0]-points[0][0]};b.GetHeight=function(){this.GetPoints();return points[2][1]-points[0][1]};b.ShowPoints=function(){var a=this.GetPoints();CTX.save();CTX.beginPath();CTX.fillStyle="#ff0000";CTX.rect(a[0][0]-2,a[0][1]-2,4,4);CTX.stroke();CTX.fill();
CTX.closePath();CTX.restore();CTX.save();CTX.beginPath();CTX.fillStyle="#00ff00";CTX.rect(a[1][0]-2,a[1][1]-2,4,4);CTX.stroke();CTX.fill();CTX.closePath();CTX.restore();CTX.save();CTX.beginPath();CTX.fillStyle="#0000ff";CTX.rect(a[2][0]-2,a[2][1]-2,4,4);CTX.stroke();CTX.fill();CTX.closePath();CTX.restore();CTX.save();CTX.beginPath();CTX.fillStyle="#aaffbb";CTX.rect(a[3][0]-2,a[3][1]-2,4,4);CTX.stroke();CTX.fill();CTX.closePath();CTX.restore()};return b}})();(function(){ArmContext.ImageInternalRepresentation=function(){var b=new ArmContext.InternalRepresentation;this._height=this._width=10;b.GetWidth=function(){return this._width};b.SetWidth=function(a){gizmo.Filter(a,"Number");this.Update({width:a,height:this.GetHeight()})};b.GetHeight=function(){return this._height};b.SetHeight=function(a){gizmo.Filter(a,"Number");this.UpdatePoints({x:this.GetX(),y:this.GetY(),width:this.GetWidth(),height:a})};b.GetPointsOfMatrix=function(){return this._points};b.SetPointsOfMatrix=
function(a){gizmo.Filter(a,"Array");return this._points};b.Update=function(a){this._width=a.width||this._width;this._height=a.height||this._height;this._points=new $M([[0,0,1],[this._width,0,1],[this._width,this._height,1],[0,this._height,1]])};return b}})();(function(b){b.ArmContext.Image=function(a){gizmo.Filter(a,"Object");var b=ArmContext.Primitive();b._internalRepresentation=ArmContext.ImageInternalRepresentation();b._2dContextRepresentation=ArmContext.Image2dContextRepresentation(b);b._globalRepresentation=ArmContext.ImageGlobalRepresentation();b.Draw=function(){var a=this._2dContextRepresentation,b=this._internalRepresentation,c=a._ctx;c.save();params=this._mvMatrix.GetTransformParams();c.setTransform(params.a,params.b,params.c,params.d,params.e,
params.f);c.drawImage(a.GetImage(),0,0,b.GetWidth(),b.GetHeight());c.restore()};b.Clear=function(){this._2dContextRepresentation.GetCtx().clearRect(0,0,500,500)};b.Update(a);return b}})(window);(function(){ArmContext.Rect2dContextRepresentation=function(b){var a=ArmContext.C2dContextRepresentation();a._primitive=b;a.parentUpdate=a.Update?a.Update:null;a._fillObject="default";a._strokeObject="default";a._lineWidth="default";a._lineDash="default";a._miterLimit="default";a._lineCap="default";a._lineJoin="default";a.GetFillObject=function(){return this._fillObject};a.GetStrokeObject=function(){return this._strokeObject};a.GetLineWidth=function(){return this._lineWidth};a.GetLineDash=function(){return this._lineDash};
a.GetMiterLimit=function(){return this._miterLimit};a.GetLineCap=function(){return this._lineCap};a.GetLineJoin=function(){return this._lineJoin};a.Update=function(a){this.parentUpdate&&this.parentUpdate(a);this._fillObject=a.fillObject||this._fillObject;this._strokeObject=a.strokeObject||this._strokeObject;this._lineWidth=a.lineWidth||this._lineWidth;this._lineDash=a.lineDash||this._lineDash;this._miterLimit=a.miterLimit||this._miterLimit;switch(a.lineCap){case "butt":this._lineCap=a.lineCap;break;
case "round":this._lineCap=a.lineCap;break;case "square":this._lineCap=a.lineCap}switch(a.lineJoin){case "miter":this._lineJoin=a.lineJoin;break;case "round":this._lineJoin=a.lineJoin;break;case "bevel":this._lineJoin=a.lineJoin}};return a}})();(function(){ArmContext.RectGlobalRepresentation=function(){var b=ArmContext.GlobalRepresentation();b.GetX=function(){return this.GetPoints()[0][0]};b.GetY=function(){return this.GetPoints()[0][1]};b.GetWidth=function(){this.GetPoints();return points[2][0]-points[0][0]};b.GetHeight=function(){this.GetPoints();return points[2][1]-points[0][1]};b.ShowPoints=function(){var a=this.GetPoints();CTX.save();CTX.beginPath();CTX.fillStyle="#ff0000";CTX.rect(a[0][0]-2,a[0][1]-2,4,4);CTX.stroke();CTX.fill();CTX.closePath();
CTX.restore();CTX.save();CTX.beginPath();CTX.fillStyle="#00ff00";CTX.rect(a[1][0]-2,a[1][1]-2,4,4);CTX.stroke();CTX.fill();CTX.closePath();CTX.restore();CTX.save();CTX.beginPath();CTX.fillStyle="#0000ff";CTX.rect(a[2][0]-2,a[2][1]-2,4,4);CTX.stroke();CTX.fill();CTX.closePath();CTX.restore();CTX.save();CTX.beginPath();CTX.fillStyle="#aaffbb";CTX.rect(a[3][0]-2,a[3][1]-2,4,4);CTX.stroke();CTX.fill();CTX.closePath();CTX.restore()};return b}})();(function(){ArmContext.RectInternalRepresentation=function(){var b=new ArmContext.InternalRepresentation;this._height=this._width=10;b.GetWidth=function(){return this._width};b.SetWidth=function(a){gizmo.Filter(a,"Number");this.Update({width:a,height:this.GetHeight()})};b.GetHeight=function(){return this._height};b.SetHeight=function(a){gizmo.Filter(a,"Number");this.UpdatePoints({x:this.GetX(),y:this.GetY(),width:this.GetWidth(),height:a})};b.GetPointsOfMatrix=function(){return this._points};b.SetPointsOfMatrix=
function(a){gizmo.Filter(a,"Array");return this._points};b.Update=function(a){this._width=a.width||this._width;this._height=a.height||this._height;this._points=new $M([[0,0,1],[this._width,0,1],[this._width,this._height,1],[0,this._height,1]])};return b}})();(function(b){b.ArmContext.Rect=function(a){gizmo.Filter(a,"Object");var b=ArmContext.Primitive();b._internalRepresentation=ArmContext.RectInternalRepresentation();b._2dContextRepresentation=ArmContext.Rect2dContextRepresentation(b);b._globalRepresentation=ArmContext.RectGlobalRepresentation();b.Draw=function(){var a=this._2dContextRepresentation,b=this._internalRepresentation,c=a.GetCtx();c.save();c.beginPath();params=this._mvMatrix.GetTransformParams();c.setTransform(params.a,params.b,params.c,params.d,
params.e,params.f);c.rect(0,0,b.GetWidth(),b.GetHeight());c.closePath();"default"!=a.GetFillObject()&&c.setFillColor(a.GetFillObject());"default"!=a.GetStrokeObject()&&c.setStrokeColor(a.GetStrokeObject());"default"!=a.GetLineWidth()&&c.setLineWidth(a.GetLineWidth());"default"!=a.GetGlobalAlpha()&&c.setAlpha(a.GetGlobalAlpha());"default"!=a.GetShadowColor()&&(c.shadowColor=a.GetShadowColor());"default"!=a.GetShadowBlur()&&(c.shadowBlur=a.GetShadowBlur());"default"!=a.GetShadowOffsetX()&&(c.shadowOffsetX=
a.GetShadowOffsetX());"default"!=a.GetShadowOffsetY()&&(c.shadowOffsetY=a.GetShadowOffsetY());"default"!=a.GetLineCap()&&c.setLineCap(a.GetLineCap());"default"!=a.GetLineDash()&&c.setLineDash(a.GetLineDash());"default"!=a.GetLineJoin()&&c.setLineJoin(a.GetLineJoin());c.stroke();c.fill();c.restore()};b.Clear=function(){this._2dContextRepresentation.GetCtx().clearRect(0,0,500,500)};b.Update(a);return b}})(window);(function(b){b.ArmContext.Loop=function(a){gizmo.Filter(a,"Object");var c={Start:function(){this._isRuning&&this.Stop();this._onEachFrame(this._stepFunc);this._isRuning=!0;return this},Stop:function(){this._isRuning&&(this._cancelAnimationFrame.call(b,this._request),this._isRuning=!1)},SetEachFrame:function(){var a=this,c;if(0<this._fps){var f=this._fps;c=function(a){this._request=setInterval(a,1E3/f)};this._cancelAnimationFrame=b.clearInterval}else b.webkitRequestAnimationFrame?c=function(b){var c=
function(){b();a._request=webkitRequestAnimationFrame(c)};c()}:b.mozRequestAnimationFrame?c=function(b){var c=function(){b();a._request=mozRequestAnimationFrame(c)};c()}:b.requestAnimationFrame?c=function(b){var c=function(){b();a._request=requestAnimationFrame(c)};c()}:b.msRequestAnimationFrame&&(c=function(b){var c=function(){b();a._request=msRequestAnimationFrame(c)};c()}),this._cancelAnimationFrame=b.cancelAnimationFrame||b.mozCancelAnimationFrame;this._onEachFrame=c},Set:function(a){for(var b in a)switch(b){case "fps":this._fps=
a[b];break;case "stepFunc":this._stepFunc=a[b]}this._isRuning?(this.Stop(),this.SetEachFrame(),this.Start()):this.SetEachFrame()},_fps:0,_stepFunc:function(){c.__clear();c.__draw()},_onEachFrame:null,_cancelAnimationFrame:null,_request:null,_isRuning:!1};c.Set(a||{});return c}})(window);(function(b){b.ArmContext.Layer=function(a){gizmo.Filter(a,"Object");var b={AddPrimitive:function(a){gizmo.Filter(a,"Object");this._childs.push(a);this.SortByZindex()},RemovePrimitive:function(a){gizmo.Filter(a,"Object");var b=0;-1!=(b=this._childs.indexOf(a))&&delete this._childs[b]},Start:function(){this._loop.Start()},Stop:function(){this._loop.Stop()},SortByZindex:function(){this._childs=gizmo.nativeSort({mas:this._childs,target:"<",field:"_2dContextRepresentation._zindex"})},SetLisener:function(a,
b){gizmo.Filter(a,"String");gizmo.Filter(b,"Function");a&&b&&(this["_"+a]?(gizmo.Filter(this["_"+a],"Array"),-1==this["_"+a].indexOf(b)?this["_"+a].push(b):console.log("This Function allredy added for event "+a+" of layer "+this.GetName())):(this["_"+a]=[],this.SetLisener(a,b)));return this},GetLisener:function(a){gizmo.Filter(a,"String");return this["_"+a]?this["_"+a]:!1},GetTopestPrimitiveUnderPoint:function(a){gizmo.Filter(a,"Object");gizmo.Filter(a.x,"Number");gizmo.Filter(a.y,"Number");for(var b=
this._childs.length-1;0<=b;b--)if(this._childs[b].IsLisened()&&this._childs[b].HasPoint(a))return this._childs[b];return null},SetCtx:function(a){gizmo.Filter(a,"CanvasRenderingContext2D");this._ctx=a},SetName:function(a){gizmo.Filter(a,"String");this._name=a},GetCtx:function(){return this._ctx},GetName:function(){return this._name},GetDefaultName:function(){return this._defaultName},GetCanvasElement:function(){return this._canvasElement},SetContainerElement:function(a){this._containerElement=a},
SetCanvasElement:function(a){gizmo.Filter(a,"HTMLCanvasElement");this._canvasElement=a},ListenMouseEvents:function(){var a=this;this.GetCanvasElement().onmousedown=function(b){a.__onMouseDown(b)};this.GetCanvasElement().onmouseup=function(b){a.__onMouseUp(b)};this.GetCanvasElement().onmousemove=function(b){a.__onMouseMove(b)}},NotListenMouseEvents:function(){this.GetCanvasElement().onmousedown=null;this.GetCanvasElement().onmouseup=null;this.GetCanvasElement().onmousemove=null},Init:function(){var a;
a=null==this._containerElementName?document.getElementsByTagName("body")[0]:document.getElementById(this._containerElementName);var b=document.createElement("canvas");b.width=this._width;b.height=this._height;b.id=this._canvasElemetName;b.style.position="absolute";a.appendChild(b);var c=b.getContext("2d");this.SetName(this._canvasElementName);this.SetContainerElement(a);this.SetCanvasElement(b);this.SetCtx(c)},__draw:function(){for(var a in this._childs)this._childs[a].Draw()},__clear:function(){for(var a=
this._childs.length-1;0<=a;a--)this._childs[a].Clear()},__onMouseDown:function(a){if(this._onMouseDown){gizmo.Filter(this._onMouseDown,"Array");for(var b in this._onMouseDown)this._onMouseDown[b](a)}},__onMouseUp:function(a){if(this._onMouseUp){gizmo.Filter(this._onMouseUp,"Array");for(var b in this._onMouseUp)this._onMouseUp[b](a)}},__onMouseMove:function(a){if(this._onMouseMove){gizmo.Filter(this._onMouseMove,"Array");for(var b in this._onMouseMove)this._onMouseMove[b](a)}},_onMouseDown:[],_onMouseUp:[],
_onMouseMove:[],Set:function(a){this.SetName(a.name||this.GetName());b._canvasElementName=null==document.getElementById(this.GetName())?this.GetName():this.GetName()+"."+ArmContext.GetNewUnicalNumber();this._containerElementName=a.container||this._containerElementName;this._width=a.width||this._width;this._height=a.height||this._height;this._left=a.left||this._left;this._top=a.top||this._top;this._zindex=a.zindex||this._zindex;this._fps=a.fps||this._fps;this._loop.Set(a);this.Init()},_defaultName:"Layer",
_ctx:null};b._name=b.GetDefaultName()+ArmContext.GetNewUnicalNumber();b._canvasElement=null;b._containerElement=null;b._width=500;b._height=500;b._left=0;b._top=0;b._fps=0;b._childs=[];b._loop=new ArmContext.Loop({stepFunc:function(){b.__clear();b.__draw()},fps:b._fps});b.Set(a);return b}})(window);
